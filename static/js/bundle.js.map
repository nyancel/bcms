{
  "version": 3,
  "sources": ["../../ts/src/editor.ts", "../../ts/src/main.ts"],
  "sourcesContent": ["const C_EDITOR_ARTICLE = {\r\n    id: undefined,\r\n    author_id: undefined,\r\n    last_changed: undefined,\r\n    content: [],\r\n};\r\n\r\n// default objects and const reffs\r\nconst C_EDITOR_BASE_PARAGRAPH = {\r\n    type: \"paragraph\",\r\n    text: \"\",\r\n    index: 0,\r\n};\r\n\r\nconst C_EDITOR_BASE_HEADING = {\r\n    type: \"heading\",\r\n    text: \"\",\r\n    index: 0,\r\n};\r\n\r\nconst C_EDITOR_BASE_IMAGE = {\r\n    type: \"image\",\r\n    alt_text: \"\",\r\n    index: 0,\r\n    image_id: undefined,\r\n};\r\n\r\nconst C_EDITOR_PARAGRAPH_TEMPLATE = document.getElementById(\r\n    \"article-paragraph-template\"\r\n);\r\nconst C_EDITOR_IMAGE_TEMPLATE = document.getElementById(\r\n    \"article-image-template\"\r\n);\r\nconst C_EDITOR_HEADING_TEMPLATE = document.getElementById(\r\n    \"article-heading-template\"\r\n);\r\n\r\nconst C_EDITOR_CONTAINER = document.getElementById(\"editor-container\");\r\n\r\n// editor image functions\r\nfunction editor_gallery_pop_up_select(index) {\r\n    const popup = window.open(\r\n        \"/gallery-popup\",\r\n        \"popupWindow\",\r\n        \"width=600,height=400\"\r\n    );\r\n\r\n    window.receive_data = function (data) {\r\n        C_EDITOR_ARTICLE.content[index].image_id = data.image_id;\r\n        editor_generate_preview();\r\n    };\r\n}\r\n\r\nfunction editor_image_upload(index) {\r\n    // select a file\r\n    let input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n    input.accept = \"png, jpg, jpeg\";\r\n    input.multiple = false;\r\n    input.onchange = async () => {\r\n        // retrieve the selected file\r\n        let files = Array.from(input.files);\r\n        let file = files[0];\r\n        input.remove();\r\n\r\n        // upload the file to the gallery\r\n        let formdata = new FormData();\r\n        formdata.append(\"media\", file);\r\n        let image = await util_fetch_post_formdata(\"/media/upload_media\", formdata);\r\n        let image_id = image.data.results[0].key;\r\n        C_EDITOR_ARTICLE.content[index].image_id = image_id;\r\n        C_EDITOR_ARTICLE.last_changed = util_epoch_seconds();\r\n        editor_generate_preview();\r\n    };\r\n    input.click();\r\n}\r\n\r\nfunction editor_image_render(entry, index) {\r\n    // if image_id is undefined we have not yet chosen an image.\r\n    let display = entry.querySelector(\".image-display\");\r\n    if (!C_EDITOR_ARTICLE.content[index].image_id) {\r\n        display.classList.toggle(\"hidden\", true);\r\n        return;\r\n    }\r\n    // else image_id is defined and we render the image\r\n    const load = async () => {\r\n        display.src = await util_get_media_src_by_width(\r\n            C_EDITOR_ARTICLE.content[index].image_id,\r\n            entry.clientWidth\r\n        );\r\n        display.classList.toggle(\"hidden\", false);\r\n    };\r\n    load();\r\n}\r\n\r\nfunction editor_insert_template(template) {\r\n    let entry = document.createElement(\"li\");\r\n    let item = template.cloneNode(true).content;\r\n    entry.appendChild(item);\r\n    C_EDITOR_CONTAINER.appendChild(entry);\r\n    return entry;\r\n}\r\n\r\nfunction editor_connect_paragraph(entry, index) {\r\n    let textarea = entry.querySelector(\".paragraph-input\");\r\n    textarea.value = C_EDITOR_ARTICLE.content[index].text;\r\n    textarea.onchange = () => {\r\n        C_EDITOR_ARTICLE.content[index].text = textarea.value;\r\n    };\r\n}\r\n\r\nfunction editor_image_connect(entry, index) {\r\n    // connect the alt-text and its relevant update\r\n    let alt_text = entry.querySelector(\".image-alt-text-input\");\r\n    if (C_EDITOR_ARTICLE.content[index].alt_text) {\r\n        alt_text.value = C_EDITOR_ARTICLE.content[index].alt_text;\r\n    }\r\n    alt_text.onchange = () => {\r\n        C_EDITOR_ARTICLE.content[index].alt_text = alt_text.value;\r\n    };\r\n\r\n    // connect the upload buttons\r\n    let image_select_button = entry.querySelector(\".image-gallery-select\");\r\n    let image_upload_button = entry.querySelector(\".image-gallery-upload\");\r\n\r\n    image_upload_button.onclick = () => editor_image_upload(index);\r\n    image_select_button.onclick = () => editor_gallery_pop_up_select(index);\r\n}\r\n\r\nfunction editor_connect_generic(entry, index) {\r\n    // generic delete\r\n    let delete_button = entry.querySelector(\".delete-button\");\r\n    delete_button.onclick = () => {\r\n        editor_remove_item(index);\r\n        editor_generate_preview();\r\n    };\r\n\r\n    // generic move up\r\n    let move_up_button = entry.querySelector(\".move-up-button\");\r\n    move_up_button.onclick = () => {\r\n        editor_move_item_up(index);\r\n        editor_generate_preview();\r\n    };\r\n\r\n    // generic move down\r\n    let move_down_button = entry.querySelector(\".move-down-button\");\r\n    move_down_button.onclick = () => {\r\n        editor_move_item_down(index);\r\n        editor_generate_preview();\r\n    };\r\n}\r\n\r\n// view functions\r\nfunction editor_generate_preview() {\r\n    let y_pos = window.scrollY;\r\n\r\n    C_EDITOR_CONTAINER.innerHTML = null;\r\n    let entry;\r\n\r\n    for (let index = 0; index < C_EDITOR_ARTICLE.content.length; index++) {\r\n        switch (C_EDITOR_ARTICLE.content[index].type) {\r\n            case \"paragraph\":\r\n                entry = editor_insert_template(C_EDITOR_PARAGRAPH_TEMPLATE);\r\n                editor_connect_paragraph(entry, index);\r\n                break;\r\n\r\n            case \"image\":\r\n                entry = editor_insert_template(C_EDITOR_IMAGE_TEMPLATE);\r\n                editor_image_render(entry, index);\r\n                editor_image_connect(entry, index);\r\n                break;\r\n\r\n            case \"heading\":\r\n                entry = editor_insert_template(C_EDITOR_HEADING_TEMPLATE);\r\n                editor_heading_connect(entry, index); // TODO fix the editor heading connector\r\n                break;\r\n\r\n            // skip to next item if we dont have a template for the type\r\n            default:\r\n                console.log(\"skipping, unkown type\");\r\n                console.log(C_EDITOR_ARTICLE.content[index]);\r\n                continue;\r\n        }\r\n        editor_connect_generic(entry, index);\r\n    }\r\n\r\n    requestAnimationFrame(() => {\r\n        window.scrollTo(0, y_pos);\r\n    });\r\n}\r\n\r\n// article functions\r\nfunction editor_add_item(item) {\r\n    let length = C_EDITOR_ARTICLE.content.length;\r\n    item.index = length;\r\n    C_EDITOR_ARTICLE.content.push(item);\r\n    C_EDITOR_ARTICLE.last_changed = util_epoch_seconds();\r\n    editor_generate_preview();\r\n}\r\n\r\nfunction editor_remove_item(index) {\r\n    C_EDITOR_ARTICLE.content.splice(index, 1);\r\n    C_EDITOR_ARTICLE.last_changed = util_epoch_seconds();\r\n}\r\n\r\nfunction editor_move_item_down(index) {\r\n    if (index > C_EDITOR_ARTICLE.content.length - 2) {\r\n        return;\r\n    }\r\n    let item = C_EDITOR_ARTICLE.content[index];\r\n    C_EDITOR_ARTICLE.content[index] = C_EDITOR_ARTICLE.content[index + 1];\r\n    C_EDITOR_ARTICLE.content[index + 1] = item;\r\n    // assign new indexes\r\n    C_EDITOR_ARTICLE.content[index].index = index;\r\n    C_EDITOR_ARTICLE.content[index + 1].index = index + 1;\r\n\r\n    C_EDITOR_ARTICLE.last_changed = util_epoch_seconds();\r\n}\r\n\r\nfunction editor_move_item_up(index) {\r\n    if (index < 1) {\r\n        return;\r\n    }\r\n    let item = C_EDITOR_ARTICLE.content[index];\r\n    C_EDITOR_ARTICLE.content[index] = C_EDITOR_ARTICLE.content[index - 1];\r\n    C_EDITOR_ARTICLE.content[index - 1] = item;\r\n    // assign new indexes\r\n    C_EDITOR_ARTICLE.content[index].index = index;\r\n    C_EDITOR_ARTICLE.content[index - 1].index = index - 1;\r\n\r\n    C_EDITOR_ARTICLE.last_changed = util_epoch_seconds();\r\n}\r\n\r\nfunction editor_add_paragraph() {\r\n    let p = { ...C_EDITOR_BASE_PARAGRAPH }; // clone the base paragraph;\r\n    editor_add_item(p);\r\n}\r\n\r\nfunction editor_add_image() {\r\n    let i = { ...C_EDITOR_BASE_IMAGE }; // clone the base paragraph;\r\n    editor_add_item(i);\r\n}\r\n\r\nfunction editor_add_heading() {\r\n    let h = { ...C_EDITOR_BASE_HEADING }; // clone the base paragraph;\r\n    editor_add_item(h);\r\n}\r\n\r\nfunction editor_log_article() {\r\n    console.log(C_EDITOR_ARTICLE.content);\r\n}\r\n\r\n// startup\r\nfunction editor_init() {\r\n\r\n}\r\n\r\nexport default function main() {\r\n    let log_button = document.getElementById(\"log-article\");\r\n    if (log_button) {\r\n        log_button.onclick = editor_log_article;\r\n    }\r\n\r\n    let add_paragraph_button = document.getElementById(\"add-paragraph\");\r\n    if (add_paragraph_button) {\r\n        add_paragraph_button.onclick = () => editor_add_item({ ...C_EDITOR_BASE_PARAGRAPH, });\r\n    }\r\n\r\n    let add_image_button = document.getElementById(\"add-image\");\r\n    add_image_button.onclick = () => editor_add_item({ ...C_EDITOR_BASE_IMAGE });\r\n\r\n    let add_heading_button = document.getElementById(\"add-heading\");\r\n    add_heading_button.onclick = () => editor_add_item({ ...C_EDITOR_BASE_HEADING, });\r\n\r\n}", "import editor_main from \"./editor\";\r\n\r\nwindow.addEventListener(\"load\", (event) => {\r\n    editor_main();\r\n});"],
  "mappings": "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",
  "names": ["C_EDITOR_ARTICLE", "C_EDITOR_BASE_PARAGRAPH", "C_EDITOR_BASE_HEADING", "C_EDITOR_BASE_IMAGE", "C_EDITOR_PARAGRAPH_TEMPLATE", "C_EDITOR_IMAGE_TEMPLATE", "C_EDITOR_HEADING_TEMPLATE", "C_EDITOR_CONTAINER", "editor_gallery_pop_up_select", "index", "popup", "data", "editor_generate_preview", "editor_image_upload", "input", "file", "formdata", "image_id", "editor_image_render", "entry", "display", "editor_insert_template", "template", "item", "editor_connect_paragraph", "textarea", "editor_image_connect", "alt_text", "image_select_button", "image_upload_button", "editor_connect_generic", "delete_button", "editor_remove_item", "move_up_button", "editor_move_item_up", "move_down_button", "editor_move_item_down", "y_pos", "editor_add_item", "length", "editor_log_article", "C_EDITOR_ARTICLE", "main", "log_button", "editor_log_article", "add_paragraph_button", "editor_add_item", "C_EDITOR_BASE_PARAGRAPH", "add_image_button", "C_EDITOR_BASE_IMAGE", "add_heading_button", "C_EDITOR_BASE_HEADING", "event", "main"]
}
