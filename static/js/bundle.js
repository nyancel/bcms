"use strict";(()=>{var m="BCMS_USERTS_LOCALTOKEN",c="BCMS_USERTS_LOCALUSER";function d(){let e=localStorage.getItem(m),t=localStorage.getItem(c);if(!e||!t)return null;let n=JSON.parse(e),r=JSON.parse(t);return!n||!r?null:{token:n,user:r}}function h(){return localStorage.removeItem(c),localStorage.removeItem(m),!0}function p(e){let t=JSON.stringify(e.token),n=JSON.stringify(e.user);return localStorage.setItem(m,t),localStorage.setItem(c,n),!0}async function g(e,t){let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await n.json();return{status_code:n.status,body:r}}async function f(e){let t=await g("/user/login",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}async function E(e){let t=await g("/user/logout",{auth_token:e});if(t.status_code!=200)throw new Error(t.body.message);return!0}async function L(e){let t=await g("/user/register",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}async function S(e){let t=await g("/user/who",{auth_token:e});if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}function M(){let e=document.querySelector(".user-details-login-template"),t=document.querySelector(".user-details-profile-template"),n=document.querySelector(".user-details-container");return!e||!t||!n?null:{login_template:e,profile_template:t,details_container:n}}function v(e){let t=e.querySelector("#user-profile-first-name"),n=e.querySelector("#user-profile-last-name"),r=e.querySelector("#user-profile-logout-button");if(!t||!n||!r)throw new Error("lastname_element not found");return{firstname_element:t,lastname_element:n,logout_button:r}}function q(){let e=d();if(!e)throw new Error("No local user-data");E(e.token.id),h(),b()}function I(e,t){t.details_container.innerHTML="";let r=t.profile_template.cloneNode(!0).content,s=v(r);s.firstname_element.innerHTML=e.user.firstname,s.lastname_element.innerHTML=e.user.lastname,s.logout_button.onclick=()=>q(),t.details_container.appendChild(r)}function k(e){let t=e.login_template.cloneNode(!0);e.details_container.innerHTML="",e.details_container.appendChild(t.content)}async function b(){let e=d(),t=M();if(!t)throw new Error("html elements not loaded");if(!e){k(t);return}I(e,t)}function U(){let e=document.querySelector("#user-register-first-name-input"),t=document.querySelector("#user-register-last-name-input"),n=document.querySelector("#user-register-email-input"),r=document.querySelector("#user-register-password-input"),s=document.querySelector("#user-register-password-repeat-input"),i=document.querySelector("#user-register-submitt-button"),a=document.querySelector("#user-signin-email-input"),l=document.querySelector("#user-signin-password-input"),_=document.querySelector("#user-signin-submitt-button");return!e||!t||!n||!r||!s||!i||!a||!l||!_?null:{registration:{email:n,first_name:e,last_name:t,password:r,repeat_password:s,submit:i},signin:{email:a,password:l,submit:_}}}function D(e,t,n){if(!e){n.registration.submit.innerHTML=t??"invalid registration-data",n.registration.submit.classList.toggle("bg-green-600",!1),n.registration.submit.classList.toggle("bg-gray-600",!0);return}n.registration.submit.innerHTML="Register",n.registration.submit.classList.toggle("bg-gray-600",!1),n.registration.submit.classList.toggle("bg-green-600",!0)}function N(e,t,n){if(!e){n.signin.submit.innerHTML=t??"invalid registration-data",n.signin.submit.classList.toggle("bg-blue-200",!1),n.signin.submit.classList.toggle("text-white",!0),n.signin.submit.classList.toggle("bg-gray-600",!0);return}n.signin.submit.innerHTML="Sign in",n.signin.submit.classList.toggle("bg-gray-600",!1),n.signin.submit.classList.toggle("text-white",!1),n.signin.submit.classList.toggle("bg-blue-200",!0)}function H(e){let t=!0,n="";return e.registration.password.value!=e.registration.repeat_password.value&&(t=!1,n="passwords dont match"),e.registration.first_name.value||(t=!1,n="missing first name"),e.registration.email.value||(t=!1,n="missing email"),e.registration.last_name.value||(t=!1,n="missing last name"),e.registration.password.value||(t=!1,n="missing password"),{valid:t,reason:n}}function O(e){let t=!0,n="";return e.signin.password.value||(t=!1,n="Please enter your password"),e.signin.email.value||(t=!1,n="Please enter your email"),{valid:t,reason:n}}function C(e){(async()=>{let n={email:e.signin.email.value,password:e.signin.password.value},r;try{r=await f(n)}catch(a){alert(a);return}let s;try{s=await S(r.id)}catch(a){alert(a);return}p({token:r,user:s}),window.location.href="/"})()}function B(e){let{valid:t,reason:n}=H(e);if(!t){alert(`could not submit registration beacuse ${n}`);return}(async()=>{let s={email:e.registration.email.value,password:e.registration.password.value,firstname:e.registration.first_name.value,lastname:e.registration.last_name.value},i;try{i=await L(s)}catch(u){alert(u);return}let a={email:s.email,password:s.password},l;try{l=await f(a)}catch(u){alert(u);return}p({token:l,user:i}),window.location.href="/"})()}function o(e){let{valid:t,reason:n}=H(e);D(t,n,e)}function w(e){let{valid:t,reason:n}=O(e);N(t,n,e)}function R(){let e=U();if(!e)throw new Error("inputs not initialized");e.registration.email.oninput=()=>o(e),e.registration.first_name.oninput=()=>o(e),e.registration.last_name.oninput=()=>o(e),e.registration.password.oninput=()=>o(e),e.registration.repeat_password.oninput=()=>o(e),e.signin.email.oninput=()=>w(e),e.signin.password.oninput=()=>w(e),e.registration.submit.onclick=()=>B(e),e.signin.submit.onclick=()=>C(e),o(e),w(e)}window.addEventListener("load",e=>{switch(b(),window.location.pathname){case"/editor":if(new URLSearchParams(window.location.search).get("draft-id")==null){console.log("no draft chosen");break}break;case"/signin":R();break;default:break}});})();
//# sourceMappingURL=bundle.js.map
