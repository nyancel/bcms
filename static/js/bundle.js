"use strict";(()=>{function o(){return new Date().getTime()/1e3}async function u(e,n){return await(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json()}async function b(e,n){console.log("called stuff");let t=await fetch(e,{method:"POST",body:n});console.log(t);let r=await t.json();return console.log(r),r}function H(){let e=document.getElementById("log-article"),n=document.getElementById("add-paragraph"),t=document.getElementById("add-image"),r=document.getElementById("add-heading");return!e||!n||!t||!r?null:{log_button:e,add_paragraph_button:n,add_image_button:t,add_heading_button:r}}function A(e){let n=document.createElement("input");n.type="file",n.accept="png, jpg, jpeg",n.multiple=!1,n.onchange=async()=>{if(!ARTICLE.content)return;let t=ARTICLE.content[e];if(t.type!=1)return;let r=n.files;if(!r)return;let a=Array.from(r)[0];n.remove();let l=new FormData;l.append("media",a);let d=(await b("/media/upload_media",l)).data.results[0].key;t.src_id=d,ARTICLE.last_changed=o(),p()},n.click()}function g(e){if(console.log(e),!EDITOR)throw new Error("Editor has not been initalized");let n=document.createElement("li"),t=e.cloneNode(!0);if(!t)throw new Error("could not clone template");let r=t.content;return n.appendChild(r),EDITOR.appendChild(n),n}function C(e,n){let t=e.querySelector(".paragraph-input");if(!t)throw new Error("Could not find textarea");let r=ARTICLE.content[n];if(r.type!=0)throw new Error("Article item at index is not a paragraph");t.value=r.text,t.onchange=()=>{r.text=t.value}}function k(e,n){let t=e.querySelector(".image-alt-text-input");if(!t)throw new Error("could not find alt_text element");let r=ARTICLE.content[n];if(r.type!=1)throw new Error("Article item at index is not a image");r.alt_text&&(t.value=r.alt_text),t.onchange=()=>{r.alt_text=t.value};let i=e.querySelector(".image-gallery-select"),a=e.querySelector(".image-gallery-upload");i&&(i.onclick=()=>editor_gallery_pop_up_select(n)),a&&(a.onclick=()=>A(n))}function S(e,n){let t=e.querySelector(".delete-button");t&&(t.onclick=()=>{R(n),p()});let r=e.querySelector(".move-up-button");r&&(r.onclick=()=>{x(n),p()});let i=e.querySelector(".move-down-button");i&&(i.onclick=()=>{v(n),p()})}function p(){let e=window.scrollY;if(!EDITOR)throw new Error("Editor is not initialized");if(!ARTICLE)throw new Error("Article is not initialized");EDITOR.innerHTML="";let n;for(let t=0;t<ARTICLE.content.length;t++){switch(ARTICLE.content[t].type){case 0:if(!TEMPLATES.paragraph)throw new Error("paragraph template not initialized");n=g(TEMPLATES.paragraph),C(n,t);break;case 1:if(!TEMPLATES.image)throw new Error("image template not initialized");console.log("inserting image"),n=g(TEMPLATES.image),editor_image_render(n,t),k(n,t);break;case 2:if(!TEMPLATES.heading)throw new Error("image template not initialized");n=g(TEMPLATES.heading);break;default:console.log("Item type in editor-render is unknown, skipping");continue}S(n,t)}requestAnimationFrame(()=>{window.scrollTo(0,e)})}function _(e){ARTICLE.content||(ARTICLE.content=[]);let n=ARTICLE.content.length,t;switch(e){case 0:case 2:t={type:e,text:"",index:n};break;case 1:t={type:e,alt_text:"",index:n,src_id:void 0};break}ARTICLE.content.push(t),ARTICLE.last_changed=o(),p()}function R(e){ARTICLE.content?.splice(e,1),ARTICLE.last_changed=o()}function v(e){if(!ARTICLE.content||e>=ARTICLE.content.length-1)return;let n=ARTICLE.content[e];ARTICLE.content[e]=ARTICLE.content[e+1],ARTICLE.content[e+1]=n,ARTICLE.content[e].index=e,ARTICLE.content[e+1].index=e+1,ARTICLE.last_changed=o()}function x(e){if(!ARTICLE.content||e<1)return;let n=ARTICLE.content[e];ARTICLE.content[e]=ARTICLE.content[e-1],ARTICLE.content[e-1]=n,ARTICLE.content[e].index=e,ARTICLE.content[e-1].index=e-1,ARTICLE.last_changed=o()}function q(){console.log(ARTICLE.content)}function f(){let e=H();if(!e)throw new Error("controll buttons not initialized");e.log_button.onclick=()=>q(),e.add_paragraph_button.onclick=()=>_(0),e.add_image_button.onclick=()=>_(1),e.add_heading_button.onclick=()=>_(2)}var L="userts-local-user-token",h="userts-local-user-data";function I(){let e=localStorage.getItem(L),n=localStorage.getItem(h);if(!e||!n)return null;let t=JSON.parse(e),r=JSON.parse(n);return!t||!r?null:{token:t,user:r}}function E(){localStorage.removeItem(h),localStorage.removeItem(L)}function T(e){let n=JSON.stringify(e.token),t=JSON.stringify(e.user);return localStorage.setItem(L,n),localStorage.setItem(h,t),!0}function B(){let e=document.querySelector(".user-details-login-template"),n=document.querySelector(".user-details-profile-template"),t=document.querySelector(".user-details-container");return!e||!n||!t?null:{login_template:e,profile_template:n,details_container:t}}function y(){let e=document.querySelector("#user-register-first-name-input"),n=document.querySelector("#user-register-last-name-input"),t=document.querySelector("#user-register-email-input"),r=document.querySelector("#user-register-password-input"),i=document.querySelector("#user-register-password-repeat-input"),a=document.querySelector("#user-register-submitt-button"),l=document.querySelector("#user-signin-email-input"),s=document.querySelector("#user-signin-password-input"),d=document.querySelector("#user-signin-submitt-button");return!e||!n||!t||!r||!i||!a||!l||!s||!d?null:{registration:{email:t,first_name:e,last_name:n,password:r,repeat_password:i,submit:a},signin:{email:l,password:s,submit:d}}}function O(){let e=I();if(!e)throw new Error("No local user-data");u("/user/logout",{user_token:e.token.id}),E(),c()}function D(){let e=B();if(!e)throw new Error("could not load html elements");e.details_container.innerHTML="";let n=I();if(!n){let s=e.login_template.cloneNode(!0);e.details_container.appendChild(s.content);return}let r=e.profile_template.cloneNode(!0).content,i=r.querySelector("#user-profile-first-name");if(!i)throw new Error("fistname_element not found");i.innerHTML=n.user.first_name;let a=r.querySelector("#user-profile-last-name");if(!a)throw new Error("lastname_element not found");a.innerHTML=n.user.last_name;let l=r.querySelector("#user-profile-logout-button");if(!l)throw new Error("logout_button not found");l.onclick=()=>{O()},e.details_container.appendChild(r)}function z(e,n){let t=y();if(!t)throw new Error("input fields not initialized");if(!e){t.registration.submit.innerHTML=n??"invalid registration-data",t.registration.submit.classList.toggle("bg-green-600",!1),t.registration.submit.classList.toggle("bg-gray-600",!0);return}t.registration.submit.innerHTML="Register",t.registration.submit.classList.toggle("bg-gray-600",!1),t.registration.submit.classList.toggle("bg-green-600",!0)}function w(e){let n=!0,t="";return e.registration.password.value!=e.registration.repeat_password.value&&(n=!1,t="passwords dont match"),e.registration.first_name.value||(n=!1,t="missing first name"),e.registration.email.value||(n=!1,t="missing email"),e.registration.last_name.value||(n=!1,t="missing last name"),e.registration.password.value||(n=!1,t="missing password"),{valid:n,reason:t}}function N(e){if(!w(e).valid)throw new Error("inputs are not valid");(async()=>{let t=y();if(!t)throw new Error("input fields not initialized");if(!w(t).valid)throw new Error("inputs are not valid");let r={email:t.registration.email.value,password:t.registration.password.value,firstname:t.registration.first_name.value,lastname:t.registration.last_name.value},i=await u("/user/register_new_user",r);if(i.error)throw new Error(i.error);let a={email:r.email,password:r.password},l=await u("/user/login",a);if(l.error)throw new Error(l.error);T({user:i,token:l}),window.location.href="/"})()}function m(e){let{valid:n,reason:t}=w(e);z(n,t)}function j(){let e=y();if(!e)throw new Error("inputs not initialized");e.registration.email.oninput=()=>m(e),e.registration.first_name.oninput=()=>m(e),e.registration.last_name.oninput=()=>m(e),e.registration.password.oninput=()=>m(e),e.registration.repeat_password.oninput=()=>m(e),e.registration.submit.onclick=()=>N(e),m(e)}async function P(){let e=I();if(!e)return null;if(o()>e.token.expires_at){E(),c();return}if(o()+600>e.token.expires_at){let t=await u("/user/refresh_token",{user_token:e.token.id});if(t.error)throw new Error(t.error);e.token=t,T(e)}let n=await u("/user/who",{user_token:e.token.id});if(n.error)if(n.error==="token invalid"){E(),c();return}else throw new Error(n.error);e.user=n,T(e)}function c(){P(),D(),window.location.pathname==="/signin"&&j()}window.addEventListener("load",e=>{window.location.pathname==="/editor"&&f(),c()});})();
//# sourceMappingURL=bundle.js.map
