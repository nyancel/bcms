"use strict";(()=>{var c="BCMS_USERTS_LOCALTOKEN",g="BCMS_USERTS_LOCALUSER";function u(){let e=localStorage.getItem(c),t=localStorage.getItem(g);if(!e||!t)return null;let r=JSON.parse(e),n=JSON.parse(t);return!r||!n?null:{token:r,user:n}}function E(){return localStorage.removeItem(g),localStorage.removeItem(c),!0}function p(e){let t=JSON.stringify(e.token),r=JSON.stringify(e.user);return localStorage.setItem(c,t),localStorage.setItem(g,r),!0}async function m(e,t){let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await r.json();return{status_code:r.status,body:n}}async function b(e){let t=await m("/user/login",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}async function T(e){let t=await m("/user/logout",{auth_token:e});if(t.status_code!=200)throw new Error(t.body.message);return!0}async function M(e){let t=await m("/user/register",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}async function L(e){let t=await m("/user/who",{auth_token:e});if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}function U(){let e=document.querySelector(".user-details-login-template"),t=document.querySelector(".user-details-profile-template"),r=document.querySelector(".user-details-container");return!e||!t||!r?null:{login_template:e,profile_template:t,details_container:r}}function D(e){let t=e.querySelector("#user-profile-first-name"),r=e.querySelector("#user-profile-last-name"),n=e.querySelector("#user-profile-logout-button");if(!t||!r||!n)throw new Error("lastname_element not found");return{firstname_element:t,lastname_element:r,logout_button:n}}function A(){let e=u();if(!e)throw new Error("No local user-data");T(e.token.id),E(),w()}function N(e,t){t.details_container.innerHTML="";let n=t.profile_template.cloneNode(!0).content,a=D(n);a.firstname_element.innerHTML=e.user.firstname,a.lastname_element.innerHTML=e.user.lastname,a.logout_button.onclick=()=>A(),t.details_container.appendChild(n)}function O(e){let t=e.login_template.cloneNode(!0);e.details_container.innerHTML="",e.details_container.appendChild(t.content)}async function w(){let e=u(),t=U();if(!t)throw new Error("html elements not loaded");if(!e){O(t);return}N(e,t)}function P(){let e=document.querySelector("#user-register-first-name-input"),t=document.querySelector("#user-register-last-name-input"),r=document.querySelector("#user-register-email-input"),n=document.querySelector("#user-register-password-input"),a=document.querySelector("#user-register-password-repeat-input"),o=document.querySelector("#user-register-submitt-button"),s=document.querySelector("#user-signin-email-input"),i=document.querySelector("#user-signin-password-input"),d=document.querySelector("#user-signin-submitt-button");return!e||!t||!r||!n||!a||!o||!s||!i||!d?null:{registration:{email:r,first_name:e,last_name:t,password:n,repeat_password:a,submit:o},signin:{email:s,password:i,submit:d}}}function C(e,t,r){if(!e){r.registration.submit.innerHTML=t??"invalid registration-data",r.registration.submit.classList.toggle("bg-green-600",!1),r.registration.submit.classList.toggle("bg-gray-600",!0);return}r.registration.submit.innerHTML="Register",r.registration.submit.classList.toggle("bg-gray-600",!1),r.registration.submit.classList.toggle("bg-green-600",!0)}function j(e,t,r){if(!e){r.signin.submit.innerHTML=t??"invalid registration-data",r.signin.submit.classList.toggle("bg-blue-200",!1),r.signin.submit.classList.toggle("text-white",!0),r.signin.submit.classList.toggle("bg-gray-600",!0);return}r.signin.submit.innerHTML="Sign in",r.signin.submit.classList.toggle("bg-gray-600",!1),r.signin.submit.classList.toggle("text-white",!1),r.signin.submit.classList.toggle("bg-blue-200",!0)}function S(e){let t=!0,r="";return e.registration.password.value!=e.registration.repeat_password.value&&(t=!1,r="passwords dont match"),e.registration.first_name.value||(t=!1,r="missing first name"),e.registration.email.value||(t=!1,r="missing email"),e.registration.last_name.value||(t=!1,r="missing last name"),e.registration.password.value||(t=!1,r="missing password"),{valid:t,reason:r}}function J(e){let t=!0,r="";return e.signin.password.value||(t=!1,r="Please enter your password"),e.signin.email.value||(t=!1,r="Please enter your email"),{valid:t,reason:r}}function K(e){(async()=>{let r={email:e.signin.email.value,password:e.signin.password.value},n;try{n=await b(r)}catch(s){alert(s);return}let a;try{a=await L(n.id)}catch(s){alert(s);return}p({token:n,user:a}),window.location.href="/"})()}function F(e){let{valid:t,reason:r}=S(e);if(!t){alert(`could not submit registration beacuse ${r}`);return}(async()=>{let a={email:e.registration.email.value,password:e.registration.password.value,firstname:e.registration.first_name.value,lastname:e.registration.last_name.value},o;try{o=await M(a)}catch(_){alert(_);return}let s={email:a.email,password:a.password},i;try{i=await b(s)}catch(_){alert(_);return}p({token:i,user:o}),window.location.href="/"})()}function l(e){let{valid:t,reason:r}=S(e);C(t,r,e)}function y(e){let{valid:t,reason:r}=J(e);j(t,r,e)}function x(){let e=P();if(!e)throw new Error("inputs not initialized");e.registration.email.oninput=()=>l(e),e.registration.first_name.oninput=()=>l(e),e.registration.last_name.oninput=()=>l(e),e.registration.password.oninput=()=>l(e),e.registration.repeat_password.oninput=()=>l(e),e.signin.email.oninput=()=>y(e),e.signin.password.oninput=()=>y(e),e.registration.submit.onclick=()=>F(e),e.signin.submit.onclick=()=>K(e),l(e),y(e)}async function R(e,t){let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await r.json();return{status_code:r.status,body:n}}async function q(e){let t=await R("/article/list_all_articles",{auth_token:e});if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}async function v(e){let t=await R("/article/post_article",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}function z(e){let t=e.querySelector(".delete-draft-button"),r=e.querySelector(".edit-draft-button"),n=e.querySelector(".draft-render-title"),a=e.querySelector(".draft-render-description");return!t||!r||!n||!a?null:{delete_draft_button:t,edit_draft_button:r,draft_render_title:n,draft_render_description:a}}function V(){let e=document.getElementById("draft-preview-template"),t=document.getElementById("editor-app-view"),r=document.getElementById("draft-controlls-template");if(!e||!t||!r)return null;let a=r.cloneNode(!0).content,o=a.querySelector(".draft-controlls"),s=a.querySelector(".new-draft-button"),i=a.querySelector(".draft-render-list");return!o||!s||!i?(console.log("controlls not found"),null):(t.innerHTML="",t.appendChild(a),{draft_preview_template:e,editor_app_view:t,draft_controlls_template:r,draft_controlls:o,new_draft_button:s,draft_render_list:i})}async function W(e){let t=await q(e.token.id);return t.length>0&&(t=t.filter(r=>r.user_id==e.user.id)),t}async function G(e){let t={auth_token:e.token.id,body:[],desc:"New draft",title:"New draft"};return await v(t)}async function Q(e,t){console.log("Not implemented yet")}function X(e,t,r){let n=t.editor_app_view;e.forEach(a=>{let s=t.draft_preview_template.cloneNode(!0).content,i=z(s);if(!i)throw new Error("could not instantiate draft template");i.draft_render_title.innerHTML=a.title,i.draft_render_description.innerHTML=a.desc,i.edit_draft_button.onclick=()=>{window.location.href=`/editor?article-id=${a.id}`},i.delete_draft_button.onclick=()=>{Q(a.id,r)},n.appendChild(s)})}async function h(){let e=u();if(!e)throw new Error("User not logged in");let t=V();if(!t)throw new Error("Draft items not found, cant render page");let r=await W(e);console.log(r),r.length>0&&X(r,t,e),t.new_draft_button.onclick=async()=>{let n=await G(e);window.location.href=`/editor?article-id=${n.id}`}}async function ee(e,t){let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return{status_code:r.status,body:await r.json()}}async function I(e){let t=await ee("/media/update_media_metadata",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}async function k(){let t={auth_token:"hi",media_ID:"FRVl6RhTeT5i-17290289321233373",metadata:{alt_text:"cool comic",is_unlisted:!1}};console.log("hi"),console.log(await I(t))}window.addEventListener("load",e=>{switch(w(),window.location.pathname){case"/editor":if(new URLSearchParams(window.location.search).get("draft-id")==null){h();break}break;case"/signin":x();break;case"/media/media_test":k();break;default:break}});})();
//# sourceMappingURL=bundle.js.map
