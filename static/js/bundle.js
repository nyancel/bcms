"use strict";(()=>{var n={id:void 0,author_id:void 0,last_changed:void 0,content:[]},g={type:"paragraph",text:"",index:0},p={type:"heading",text:"",index:0},m={type:"image",alt_text:"",index:0,image_id:void 0},s=document.getElementById("article-paragraph-template"),h=document.getElementById("article-image-template"),f=document.getElementById("article-heading-template"),r=document.getElementById("editor-container");function E(e){let t=window.open("/gallery-popup","popupWindow","width=600,height=400");window.receive_data=function(o){n.content[e].image_id=o.image_id,i()}}function y(e){let t=document.createElement("input");t.type="file",t.accept="png, jpg, jpeg",t.multiple=!1,t.onchange=async()=>{let a=Array.from(t.files)[0];t.remove();let c=new FormData;c.append("media",a);let u=(await util_fetch_post_formdata("/media/upload_media",c)).data.results[0].key;n.content[e].image_id=u,n.last_changed=util_epoch_seconds(),i()},t.click()}function w(e,t){let o=e.querySelector(".image-display");if(!n.content[t].image_id){o.classList.toggle("hidden",!0);return}(async()=>{o.src=await util_get_media_src_by_width(n.content[t].image_id,e.clientWidth),o.classList.toggle("hidden",!1)})()}function l(e){let t=document.createElement("li"),o=e.cloneNode(!0).content;return t.appendChild(o),r.appendChild(t),t}function I(e,t){let o=e.querySelector(".paragraph-input");o.value=n.content[t].text,o.onchange=()=>{n.content[t].text=o.value}}function A(e,t){let o=e.querySelector(".image-alt-text-input");n.content[t].alt_text&&(o.value=n.content[t].alt_text),o.onchange=()=>{n.content[t].alt_text=o.value};let a=e.querySelector(".image-gallery-select"),c=e.querySelector(".image-gallery-upload");c.onclick=()=>y(t),a.onclick=()=>E(t)}function T(e,t){let o=e.querySelector(".delete-button");o.onclick=()=>{b(t),i()};let a=e.querySelector(".move-up-button");a.onclick=()=>{v(t),i()};let c=e.querySelector(".move-down-button");c.onclick=()=>{k(t),i()}}function i(){let e=window.scrollY;r.innerHTML=null;let t;for(let o=0;o<n.content.length;o++){switch(n.content[o].type){case"paragraph":t=l(s),I(t,o);break;case"image":t=l(h),w(t,o),A(t,o);break;case"heading":t=l(f),editor_heading_connect(t,o);break;default:console.log("skipping, unkown type"),console.log(n.content[o]);continue}T(t,o)}requestAnimationFrame(()=>{window.scrollTo(0,e)})}function d(e){let t=n.content.length;e.index=t,n.content.push(e),n.last_changed=util_epoch_seconds(),i()}function b(e){n.content.splice(e,1),n.last_changed=util_epoch_seconds()}function k(e){if(e>n.content.length-2)return;let t=n.content[e];n.content[e]=n.content[e+1],n.content[e+1]=t,n.content[e].index=e,n.content[e+1].index=e+1,n.last_changed=util_epoch_seconds()}function v(e){if(e<1)return;let t=n.content[e];n.content[e]=n.content[e-1],n.content[e-1]=t,n.content[e].index=e,n.content[e-1].index=e-1,n.last_changed=util_epoch_seconds()}function R(){console.log(n.content)}function _(){let e=document.getElementById("log-article");e&&(e.onclick=R);let t=document.getElementById("add-paragraph");t&&(t.onclick=()=>d({...g}));let o=document.getElementById("add-image");o.onclick=()=>d({...m});let a=document.getElementById("add-heading");a.onclick=()=>d({...p})}window.addEventListener("load",e=>{_()});})();
//# sourceMappingURL=bundle.js.map
