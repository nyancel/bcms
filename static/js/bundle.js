"use strict";(()=>{var g="BCMS_USERTS_LOCALTOKEN",m="BCMS_USERTS_LOCALUSER";function d(){let e=localStorage.getItem(g),t=localStorage.getItem(m);if(!e||!t)return null;let r=JSON.parse(e),n=JSON.parse(t);return!r||!n?null:{token:r,user:n}}function f(){return localStorage.removeItem(m),localStorage.removeItem(g),!0}function b(e){let t=JSON.stringify(e.token),r=JSON.stringify(e.user);return localStorage.setItem(g,t),localStorage.setItem(m,r),!0}async function c(e,t){let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await r.json();return{status_code:r.status,body:n}}async function y(e){let t=await c("/user/login",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}async function h(e){let t=await c("/user/logout",{auth_token:e});if(t.status_code!=200)throw new Error(t.body.message);return!0}async function E(e){let t=await c("/user/register",e);if(t.status_code!=200)throw new Error(t.body.message);return t.body.data}function H(){let e=document.querySelector(".user-details-login-template"),t=document.querySelector(".user-details-profile-template"),r=document.querySelector(".user-details-container");return!e||!t||!r?null:{login_template:e,profile_template:t,details_container:r}}function R(e){let t=e.querySelector("#user-profile-first-name"),r=e.querySelector("#user-profile-last-name"),n=e.querySelector("#user-profile-logout-button");if(!t||!r||!n)throw new Error("lastname_element not found");return{firstname_element:t,lastname_element:r,logout_button:n}}function M(){let e=d();if(!e)throw new Error("No local user-data");h(e.token.id),f(),p()}function q(e,t){t.details_container.innerHTML="";let n=t.profile_template.cloneNode(!0).content,s=R(n);s.firstname_element.innerHTML=e.user.firstname,s.lastname_element.innerHTML=e.user.lastname,s.logout_button.onclick=()=>M(),t.details_container.appendChild(n)}function v(e){let t=e.login_template.cloneNode(!0);e.details_container.innerHTML="",e.details_container.appendChild(t.content)}async function p(){let e=d(),t=H();if(!t)throw new Error("html elements not loaded");if(!e){v(t);return}q(e,t)}function x(){let e=document.querySelector("#user-register-first-name-input"),t=document.querySelector("#user-register-last-name-input"),r=document.querySelector("#user-register-email-input"),n=document.querySelector("#user-register-password-input"),s=document.querySelector("#user-register-password-repeat-input"),o=document.querySelector("#user-register-submitt-button"),l=document.querySelector("#user-signin-email-input"),i=document.querySelector("#user-signin-password-input"),_=document.querySelector("#user-signin-submitt-button");return!e||!t||!r||!n||!s||!o||!l||!i||!_?null:{registration:{email:r,first_name:e,last_name:t,password:n,repeat_password:s,submit:o},signin:{email:l,password:i,submit:_}}}function k(e,t,r){if(!e){r.registration.submit.innerHTML=t??"invalid registration-data",r.registration.submit.classList.toggle("bg-green-600",!1),r.registration.submit.classList.toggle("bg-gray-600",!0);return}r.registration.submit.innerHTML="Register",r.registration.submit.classList.toggle("bg-gray-600",!1),r.registration.submit.classList.toggle("bg-green-600",!0)}function L(e){let t=!0,r="";return e.registration.password.value!=e.registration.repeat_password.value&&(t=!1,r="passwords dont match"),e.registration.first_name.value||(t=!1,r="missing first name"),e.registration.email.value||(t=!1,r="missing email"),e.registration.last_name.value||(t=!1,r="missing last name"),e.registration.password.value||(t=!1,r="missing password"),{valid:t,reason:r}}function U(e){let{valid:t,reason:r}=L(e);if(!t){alert(`could not submit registration beacuse ${r}`);return}(async()=>{let s={email:e.registration.email.value,password:e.registration.password.value,firstname:e.registration.first_name.value,lastname:e.registration.last_name.value},o;try{o=await E(s)}catch(u){alert(u);return}let l={email:s.email,password:s.password},i;try{i=await y(l)}catch(u){alert(u);return}b({token:i,user:o}),window.location.href="/"})()}function a(e){let{valid:t,reason:r}=L(e);k(t,r,e)}function S(){let e=x();if(!e)throw new Error("inputs not initialized");e.registration.email.oninput=()=>a(e),e.registration.first_name.oninput=()=>a(e),e.registration.last_name.oninput=()=>a(e),e.registration.password.oninput=()=>a(e),e.registration.repeat_password.oninput=()=>a(e),e.registration.submit.onclick=()=>U(e),a(e)}window.addEventListener("load",e=>{switch(p(),window.location.pathname){case"/signin":S();break;default:break}});})();
//# sourceMappingURL=bundle.js.map
