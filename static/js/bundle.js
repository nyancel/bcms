"use strict";(()=>{function a(){return new Date().getTime()/1e3}var i={id:void 0,author_id:void 0,last_changed:void 0,content:[]},L={paragraph:document.getElementById("article-paragraph-template"),image:document.getElementById("article-paragraph-template"),heading:document.getElementById("article-heading-template")},p=document.getElementById("editor-container");function g(e){let t=window.open("/gallery-popup","popupWindow","width=600,height=400");window.receive_data=function(n){if(!i.content)return;let o=i.content[e];o.type==1&&(o.src_id=n,r())}}function f(e){let t=document.createElement("input");t.type="file",t.accept="png, jpg, jpeg",t.multiple=!1,t.onchange=async()=>{if(!i.content)return;let n=i.content[e];if(n.type!=1)return;let o=t.files;if(!o)return;let c=Array.from(o)[0];t.remove();let s=new FormData;s.append("media",c);let _=(await util_fetch_post_formdata("/media/upload_media",s)).data.results[0].key;n.src_id=_,i.last_changed=a(),r()},t.click()}function E(e,t){let n=e.querySelector(".image-display");if(!n)throw new Error("media-display not found");if(!i.content)throw new Error("article content not initialized");let o=i.content[t];if(o.type!=1)throw new Error("item type is not image");if(!o.src_id){n.classList.toggle("hidden",!0);return}(async()=>{if(!i.content)throw new Error("article content not initialized");let c=i.content[t];if(c.type!=1)throw new Error("item type is not image");n.src=await util_get_media_src_by_width(c.src_id,e.clientWidth),n.classList.toggle("hidden",!1)})()}function d(e){if(!p)throw new Error("Editor has not been initalized");let t=document.createElement("li"),o=e.cloneNode(!0).content;return t.appendChild(o),p.appendChild(t),t}function h(e,t){let n=e.querySelector(".paragraph-input");n.value=C_EDITOR_ARTICLE.content[t].text,n.onchange=()=>{C_EDITOR_ARTICLE.content[t].text=n.value}}function y(e,t){let n=e.querySelector(".image-alt-text-input");C_EDITOR_ARTICLE.content[t].alt_text&&(n.value=C_EDITOR_ARTICLE.content[t].alt_text),n.onchange=()=>{C_EDITOR_ARTICLE.content[t].alt_text=n.value};let o=e.querySelector(".image-gallery-select"),l=e.querySelector(".image-gallery-upload");l.onclick=()=>f(t),o.onclick=()=>g(t)}function I(e,t){let n=e.querySelector(".delete-button");n.onclick=()=>{T(t),r()};let o=e.querySelector(".move-up-button");o.onclick=()=>{b(t),r()};let l=e.querySelector(".move-down-button");l.onclick=()=>{w(t),r()}}function r(){let e=window.scrollY;C_EDITOR_CONTAINER.innerHTML=null;let t;for(let n=0;n<C_EDITOR_ARTICLE.content.length;n++){switch(C_EDITOR_ARTICLE.content[n].type){case"paragraph":t=d(C_EDITOR_PARAGRAPH_TEMPLATE),h(t,n);break;case"image":t=d(C_EDITOR_IMAGE_TEMPLATE),E(t,n),y(t,n);break;case"heading":t=d(C_EDITOR_HEADING_TEMPLATE),editor_heading_connect(t,n);break;default:console.log("skipping, unkown type"),console.log(C_EDITOR_ARTICLE.content[n]);continue}I(t,n)}requestAnimationFrame(()=>{window.scrollTo(0,e)})}function m(e){i.content||(i.content=[]);let t=i.content.length,n;switch(e){case 0:case 2:n={type:e,text:"",index:t};break;case 1:n={type:e,alt_text:"",index:t,src_id:void 0};break}i.content.push(n),i.last_changed=a(),r()}function T(e){i.content?.splice(e,1),i.last_changed=a()}function w(e){if(!i.content||e>=i.content.length-1)return;let t=i.content[e];i.content[e]=i.content[e+1],i.content[e+1]=t,i.content[e].index=e,i.content[e+1].index=e+1,i.last_changed=a()}function b(e){if(!i.content||e<1)return;let t=i.content[e];i.content[e]=i.content[e-1],i.content[e-1]=t,i.content[e].index=e,i.content[e-1].index=e-1,i.last_changed=a()}function C(){console.log(i.content)}function u(){let e=document.getElementById("log-article");e&&(e.onclick=()=>C());let t=document.getElementById("add-paragraph");t&&(t.onclick=()=>m(0));let n=document.getElementById("add-image");n&&(n.onclick=()=>m(1));let o=document.getElementById("add-heading");o&&(o.onclick=()=>m(2))}window.addEventListener("load",e=>{u()});})();
//# sourceMappingURL=bundle.js.map
